(()=>{const h="prospectiq-badge",g="prospectiq-card",f="ICP_ACTIVE";if(document.getElementById(h))return;function x(){const e=document.createElement("button");e.id=h,e.textContent="Score ICP",e.style.position="fixed",e.style.bottom="16px",e.style.right="16px",e.style.zIndex="2147483647",e.style.background="#22c55e",e.style.color="#0f172a",e.style.fontWeight="700",e.style.border="0",e.style.borderRadius="10px",e.style.padding="10px 12px",e.style.boxShadow="0 6px 20px rgba(2,6,23,0.35)",e.style.cursor="pointer",e.addEventListener("click",I),document.body.appendChild(e)}async function b(){try{return(await chrome.storage.sync.get(f))?.[f]||{}}catch{return{}}}function _(){const e=location.hostname.toLowerCase(),t=document.documentElement.outerHTML||"",o=document.body?.innerText||"",n={pays:void 0,secteur_text:void 0,taille_estimee:void 0,role_text:void 0,note_google:void 0,techno_detectees:[],texte:o.slice(0,2e3)},c=e.match(/\.([a-z]{2})(?:$|:|\/)/),d={fr:"FR",de:"DE",es:"ES",it:"IT",nl:"NL",be:"BE",ch:"CH",uk:"UK"};if(c&&(n.pays=d[c[1]]||c[1].toUpperCase()),/(^|\.)(google\.)[^/]+\/maps/.test(location.href)||/maps\.google\./.test(e)){let s;const i=document.querySelector('[aria-label*="Étoiles"], [aria-label*="stars"], [aria-label*="rating"]');if(i){const r=(i.getAttribute("aria-label")||"").match(/(\d+[.,]\d+)/);r&&(s=Number(r[1].replace(",",".")))}if(s==null){const r=t.match(/(\d+,[0-9])\s*★/);r&&(s=Number(r[1].replace(",",".")))}return n.note_google=s,n}if(e.includes("linkedin.com")){const s=document.querySelector("h1")?.textContent||""||document.querySelector("h2")?.textContent||"";n.role_text=s.trim()||void 0;const i=document.querySelector(".inline-show-more-text");if(i&&(n.secteur_text=i.textContent?.trim()),!n.secteur_text){const l=document.querySelector('meta[name="industry"], meta[property="og:description"]');l&&(n.secteur_text=l.getAttribute("content")||void 0)}const r=(o.match(/(\d[\d\s]*)(?:\+)?\s*employ[eé]s?/i)||[])[0]||"",y=r.match(/(\d+)\s*[-–]\s*(\d+)/);if(y){const l=Number(y[1]),w=Number(y[2]);n.taille_estimee=Math.round((l+w)/2)}else{const l=r.match(/(\d+)\s*\+\s*employ/i);l&&(n.taille_estimee=Number(l[1]))}return n}try{(window.Shopify||/shopify/i.test(t)||Array.from(document.scripts).some(s=>/shopify/i.test(s.src)))&&n.techno_detectees.push("Shopify")}catch{}(/woocommerce/i.test(t)||Array.from(document.scripts).some(s=>/woocommerce/i.test(s.src)))&&n.techno_detectees.push("WooCommerce");const u=document.querySelector('meta[name="description"]')?.getAttribute("content")||"";return n.secteur_text=u||document.title||void 0,n}function a(e,t){if(!e)return!1;const o=e.toLowerCase();return t.some(n=>o.includes(String(n).toLowerCase()))}function C(e,t){let o=0;const n=[],c=e.secteurs||[],d=e.roles||[],m=e.techno_inclues||[],p=e.exclusions_mots||[];if(e.pays&&t.pays&&String(e.pays).toUpperCase()===String(t.pays).toUpperCase()&&(o+=25,n.push("Pays/TLD correspondant (+25)")),c.length&&(a(t.secteur_text,c)||a(t.texte,c))&&(o+=20,n.push("Secteur correspondant (+20)")),(e.taille_min!=null||e.taille_max!=null)&&t.taille_estimee!=null){const u=e.taille_min!=null?Number(e.taille_min):-1/0,s=e.taille_max!=null?Number(e.taille_max):1/0;t.taille_estimee>=u&&t.taille_estimee<=s&&(o+=15,n.push("Taille dans la plage (+15)"))}return d.length&&a(t.role_text,d)&&(o+=15,n.push("Rôle ciblé présent (+15)")),(t.techno_detectees||[]).length&&m.length&&t.techno_detectees.filter(s=>m.map(i=>String(i).toLowerCase()).includes(String(s).toLowerCase())).length&&(o+=10,n.push("Technologie demandée détectée (+10)")),e.note_google_max!=null&&t.note_google!=null&&Number(t.note_google)<=Number(e.note_google_max)&&(o+=10,n.push("Note Google sous le seuil (+10)")),p.length&&a(t.texte,p)&&(o-=20,n.push("Mot-clé d’exclusion détecté (-20)")),o=Math.max(0,Math.min(100,o)),{score:o,reasons:n}}function S(e){let t=document.getElementById(g);t||(t=document.createElement("div"),t.id=g,t.style.position="fixed",t.style.bottom="64px",t.style.right="16px",t.style.zIndex="2147483647",t.style.background="#0f172a",t.style.color="#fff",t.style.padding="12px 14px",t.style.borderRadius="10px",t.style.boxShadow="0 6px 24px rgba(2,6,23,0.4)",t.style.width="320px",document.body.appendChild(t));const o=(e.reasons||[]).slice(0,3).map(n=>`• ${n}`).join("<br/>");t.innerHTML=`<div style="font-weight:700;margin-bottom:6px">Score: ${e.score}/100</div><div style="font-size:12px;color:#cbd5e1">${o}</div>`}async function I(){const e=await b(),t=_(),o=C(e,t);S(o)}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",x,{once:!0}):x()})();console.debug("[ProspectIQ] content script loaded");
